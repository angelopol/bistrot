<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mesas</title>
    <link rel="stylesheet" href="/reservas/mesas.css">
    <link rel="stylesheet" href="/reservas/side.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap">
    <link rel="icon" href="/assets/favicon.ico">
    <script src="/assets/logout.js" defer></script>
    <script src="/assets/user.js" defer></script>
    <script src="/assets/side.js" defer></script>
</head>
<body>
    <header>
        <h1 id="title">BISTROT CHEZ RÉMY</h1>
        <select id="title-combo">
            <option selected>Gerente</option>
            <option>Cerrar Sesion</option>
        </select>
    </header>
    <div class="pagina">
        <div id="sidebar">
            <div class="side inicio">
                <img src="/Compras/resources/iconos_barra/inicio-green.png" class="side-foto">
                <p class="side-option">Inicio</p>
            </div>
            <div class="side ventas">
                <img class="side-foto" src="/Compras/resources/iconos_barra/ventas-green.png">
                <p class="side-option">Ventas/Salon</p>
            </div>
            <div class="side compras">
                <img class="side-foto" src="/Compras/resources/iconos_barra/compras-green.png">
                <p class="side-option">Compras</p>
            </div>
            <div class="side rrhh">
                <img class="side-foto" src="/Compras/resources/iconos_barra/person-green.png">
                <p class="side-option">RRHH</p>
            </div>
            <div class="side inventario">
                <img class="side-foto" src="/Compras/resources/iconos_barra/inventario-green.png">
                <p class="side-option">Inventario</p>
            </div>
            <div class="side mantent">
                <img class="side-foto" src="/Compras/resources/iconos_barra/mantenimiento-green.png">
                <p class="side-option">Mantenimiento</p>
            </div>
            <div class="side cocina">
                <img class="side-foto" src="/Compras/resources/iconos_barra/cocina-green.png">
                <p class="side-option">Cocina/Bar</p>
            </div>
            <div class="side reserv">
                <img class="side-foto" src="/Compras/resources/iconos_barra/reservas-green.png">
                <p class="side-option">Reservas</p>
            </div>
        </div>
        <div class="contenido">
            <div class="contenidop">
                <div class="Reservar">
                    <h2>
                        <a href="/reservas">
                            <img src="/reservas/imagenes/icono_salida.png" alt="regresar">
                        </a>
                        Reservar
                    </h2>
                </div>
                <div class="seccion">
                    <h2>Mesas</h2>
                </div>
            </div>
            <div class="distribucion">
                <div class="arriba">
                    <div class="interior">
                        <h3>Interior</h3>
                        <div class="button" data-number="1" data-location="interior">1</div>
                        <div class="button" data-number="2" data-location="interior">2</div>
                        <div class="button" data-number="3" data-location="interior">3</div>
                        <div class="button" data-number="4" data-location="interior">4</div>
                        <div class="button" data-number="5" data-location="interior">5</div>
                        <div class="button" data-number="6" data-location="interior">6</div>
                        <div class="button" data-number="7" data-location="interior">7</div>
                        <div class="button" data-number="8" data-location="interior">8</div>
                        <div class="button" data-number="9" data-location="interior">9</div>
                    </div>
                    <div class="exterior">
                        <h3>Exterior</h3>
                        <div class="button" data-number="10" data-location="exterior">10</div>
                        <div class="button" data-number="11" data-location="exterior">11</div>
                    </div>
                </div>
                <div class="abajo">
                    <h3>Barra</h3>
                    <div class="button" data-number="12" data-location="barra">12</div>
                    <div class="button" data-number="13" data-location="barra">13</div>
                    <div class="button" data-number="14" data-location="barra">14</div>
                    <div class="button" data-number="15" data-location="barra">15</div>
                    <div class="button" data-number="16" data-location="barra">16</div>
                </div>
            </div>
            <button id="mesa">Seleccionar mesa</button>
            <div id="mesas-container"></div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Array para almacenar los números de mesa seleccionados
            let selectedButtons = JSON.parse(localStorage.getItem("selectedButtons")) || [];
            
            // Set para almacenar las ubicaciones seleccionadas (interior, exterior, barra)
            let selectedLocations = new Set();

            // Función para actualizar la visualización de las mesas seleccionadas
            function updateSelectedButtons() {
                document.querySelectorAll(".button").forEach(button => {
                    const number = button.getAttribute("data-number");
                    if (selectedButtons.includes(number)) {
                            button.classList.add("selected");
                        
                    } else {
                        button.classList.remove("selected");
                    }
                });
            }

            // Cargar la selección almacenada al cargar la página
            updateSelectedButtons();

            // Añadir evento de clic a todos los botones de mesa
            document.querySelectorAll(".button").forEach(button => {
                button.addEventListener("click", function() {
                    const number = this.getAttribute("data-number");
                    const location = this.getAttribute("data-location");
                    if (this.classList.contains("selected")) {
                        if(this.classList.contains("reservado")){
                            alert('Reservado')
                        }
                        else{
                            this.classList.remove("selected");
                            selectedButtons = selectedButtons.filter(btn => btn !== number);
                            selectedLocations.delete(location);
                        }

                    } 
                    else {
                            this.classList.add("selected");
                            selectedButtons.push(number);
                            selectedLocations.add(location);
                    }
                    localStorage.setItem("selectedButtons", JSON.stringify(selectedButtons));
                });
            });

            // Añadir evento al botón "Seleccionar mesas"
            const mesaButton = document.getElementById("mesa");
            mesaButton.addEventListener("click", function() {
                const selectedNumbers = selectedButtons.join(",");
                const selectedLocationsArray = Array.from(selectedLocations).join(",");

                let asientos_select = document.getElementsByClassName('selected')

                for (let i = 0; i < asientos_select.length; i++) {
                    asientos_select[i].classList.add('reservado')
                }

                // Crear inputs ocultos para mesas y ubicaciones
                const inputMesas = document.createElement("input");
                inputMesas.type = "hidden";
                inputMesas.name = "mesas";
                inputMesas.value = selectedNumbers;

                const inputLocations = document.createElement("input");
                inputLocations.type = "hidden";
                inputLocations.name = "zonas";
                inputLocations.value = selectedLocationsArray;

                // Adjuntar los inputs al elemento contenedor de mesas
                const mesasContainer = document.getElementById("mesas-container");
                mesasContainer.innerHTML = ""; // Limpiar contenido anterior si existe
                mesasContainer.appendChild(inputMesas);
                mesasContainer.appendChild(inputLocations);

                console.log("Mesas seleccionadas:", selectedNumbers);
                console.log("Zonas seleccionadas:", selectedLocationsArray);
                
                // Puedes realizar más acciones aquí, como enviar los datos a través de AJAX o redirigir
                window.location.href = "/reservas/CrearReservas";
            });
        });
    </script>
</body>
</html>
